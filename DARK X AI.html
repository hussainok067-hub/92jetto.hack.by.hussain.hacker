<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- TITLE NOW LOADS FROM FIREBASE -->
<title id="pageTitle">Loading...</title> 
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@700;900&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #000;
  --tele-blue-start: #5fd3ff;
  --tele-blue-end: #2d8cf0;
  --card-grad: linear-gradient(90deg,#b3e5ff,#c7a6ff,#ffb6e6);
  --pill-bg: linear-gradient(180deg,#071026,#021020);
}
* { box-sizing: border-box; }
body {
  margin: 0; background: var(--bg); color: #fff;
  font-family: 'Inter', sans-serif; overflow-x: hidden;
}
.top-panel { position: fixed; top: 10px; left: 0; right: 0;
  display: flex; justify-content: center; z-index: 1000;
}
.container { width: 100%; max-width: 420px; display: flex;
  flex-direction: column; align-items: center; gap: 10px;
  padding: 0 12px;
}
.open-tele {
  width: 100%; text-align: center;
  background: linear-gradient(90deg,var(--tele-blue-start),var(--tele-blue-end));
  color: #fff; font-weight: 900; font-size: 14px;
  letter-spacing: 1px; border-radius: 8px; padding: 10px 12px;
  text-decoration: none; box-shadow: 0 8px 18px rgba(45,140,240,0.2);
}
.photo-card {
  width: 100%; background: var(--card-grad); border-radius: 12px;
  padding: 14px; box-shadow: 0 10px 25px rgba(0,0,0,0.6);
  display: flex; flex-direction: column; align-items: center; gap: 8px;
  text-align: center;
}
/* ADDED ID HERE */
.title { font-size: 16px; font-weight: 900; color: #001b2e; } 
.row-show { display: flex; align-items: center; justify-content: center; gap: 8px; }
.show-text { font-size: 13px; font-weight: 800; color: #012b3a; }
.small-switch { position: relative; width: 46px; height: 24px; }
.small-switch input { opacity: 0; width: 0; height: 0; }
.small-slider { position: absolute; inset: 0; border-radius: 20px;
  background: rgba(0,0,0,0.25); border: 1px solid rgba(255,255,255,0.1);
}
.small-slider:before { content: ""; position: absolute; left: 4px; top: 4px;
  width: 16px; height: 16px; border-radius: 50%; background: #ff8b6b; transition: 0.3s;
}
.small-switch input:checked + .small-slider {
  background: linear-gradient(90deg,#7efcc5,#2de6a1);
}
.small-switch input:checked + .small-slider:before {
  transform: translateX(22px); background: #fff;
}
.series-text { font-weight: 900; font-size: 14px; color: #022b36; }
.size-text { font-weight: 900; font-size: 15px; color: #ff8b6b; }
.pills { display: flex; justify-content: center; gap: 10px; margin-top: 6px; }
.pill {
  width: 60px; height: 42px; border-radius: 25px;
  background: var(--pill-bg); color: #dfffe7;
  font-weight: 900; font-size: 20px;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 10px 25px rgba(0,0,0,0.6),inset 0 -6px 12px rgba(255,255,255,0.02);
  position: relative; overflow: hidden;
}
.loader-inner {
  position: absolute;
  width: 28px; height: 28px;
  border: 4px solid rgba(255,255,255,0.2);
  border-top-color: #00d4ff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  display: none;
}
@keyframes spin { to { transform: rotate(360deg); } }

.game-wrap {
  position: fixed; left: 0; right: 0; bottom: 0; background: #000;
  transition: top 0.3s ease;
}
.game-wrap.number-hidden { top: 120px; }
.game-wrap:not(.number-hidden) { top: 230px; }
.game-iframe { width: 100%; height: 100%; border: 0; display: block; }
</style>
<!-- ADD FIREBASE SDKS -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>

<div class="top-panel">
  <div class="container">
    <a href="https://t.me/+0OEWGD1eZO1hNzE1" class="open-tele" target="_blank">OPEN TELEGRAM</a>

    <div class="photo-card">
      <!-- ADDED ID HERE -->
      <div class="title" id="mainHackName">Loading Hack Name...</div> 
      <div class="row-show">
        <div class="show-text">Show Number</div>
        <label class="small-switch">
          <input type="checkbox" id="photoToggle" checked>
          <span class="small-slider"></span>
        </label>
      </div>
      <div class="series-text" id="seriesText">PERIOD | ---</div>
      <div class="size-text" id="sizeText">--</div>
      <div class="pills">
        <div class="pill"><div id="pill1">-</div><div class="loader-inner" id="load1"></div></div>
        <div class="pill"><div id="pill2">-</div><div class="loader-inner" id="load2"></div></div>
        <div class="pill"><div id="pill3">-</div><div class="loader-inner" id="load3"></div></div>
      </div>
    </div>
  </div>
</div>

<div class="game-wrap number-hidden" id="gameWrap">
  <iframe class="game-iframe"
    src="https://www.jalwagameapp5.com/#/register?invitationCode=416174049222"
    allowfullscreen></iframe>
</div>

<script>
(function(){
  const API_URL = 'https://api.bdg88zf.com/api/webapi/GetGameIssue';
  const API_PAYLOAD = {
    typeId: 1, language: 0,
    random: "40079dcba93a48769c6ee9d4d4fae23f",
    signature: "D12108C4F57C549D82B23A91E0FA20AE",
    timestamp: 1727792520
  };

  const p1 = document.getElementById('pill1');
  const p2 = document.getElementById('pill2');
  const p3 = document.getElementById('pill3');
  const l1 = document.getElementById('load1');
  const l2 = document.getElementById('load2');
  const l3 = document.getElementById('load3');
  const seriesText = document.getElementById('seriesText');
  const sizeText = document.getElementById('sizeText');
  const toggle = document.getElementById('photoToggle');
  const wrap = document.getElementById('gameWrap');
  
  // NEW: Firebase Elements
  const mainHackNameEl = document.getElementById('mainHackName');
  const telegramLinkEl = document.querySelector('.open-tele');
  const gameIframeEl = document.querySelector('.game-iframe');


  let lastPeriod = null;
  let animating = false;

  const LOGIC = {
    1:{number:'0/2/4',size:'SMALL',color:'#4cc9ff'},
    2:{number:'0/7/4',size:'SMALL',color:'#4cc9ff'},
    3:{number:'7/1/9',size:'BIGG',color:'#ff8b6b'},
    4:{number:'6/8/2',size:'BIGG',color:'#ff8b6b'},
    5:{number:'5/9/3',size:'BIGG',color:'#ff8b6b'},
    6:{number:'5/7/0',size:'BIGG',color:'#ff8b6b'},
    7:{number:'0/2/8',size:'SMALL',color:'#4cc9ff'},
    8:{number:'4/6/1',size:'SMALL',color:'#4cc9ff'},
    9:{number:'1/3/9',size:'SMALL',color:'#4cc9ff'},
    0:{number:'5/9/7',size:'BIGG',color:'#ff8b6b'}
  };

  function showLoaders(){
    [l1,l2,l3].forEach(l => l.style.display='block');
    [p1,p2,p3].forEach(p => p.style.visibility='hidden');
  }
  function hideLoaders(){
    [l1,l2,l3].forEach(l => l.style.display='none');
    [p1,p2,p3].forEach(p => p.style.visibility='visible');
  }
  function renderPrediction(numStr, size, color){
    const parts = numStr.split('/');
    p1.textContent = parts[0]; p2.textContent = parts[1]; p3.textContent = parts[2];
    sizeText.textContent = size;
    sizeText.style.color = color;
  }

  toggle.addEventListener('change', () => {
    if (toggle.checked) {
      [p1,p2,p3].forEach(p => p.style.visibility='visible');
      wrap.classList.remove('number-hidden');
    } else {
      [p1,p2,p3].forEach(p => p.style.visibility='hidden');
      wrap.classList.add('number-hidden');
    }
  });

  async function fetchPeriod(){
    try {
      // NOTE: Using static payload from original file.
      const res = await fetch(API_URL, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(API_PAYLOAD)
      });
      const j = await res.json();
      if(j && j.code===0 && j.data && j.data.issueNumber){
        const currentPeriod = j.data.issueNumber.toString();
        const lastDigit = parseInt(currentPeriod.slice(-1));

        if(currentPeriod !== lastPeriod && !animating){
          lastPeriod = currentPeriod;
          animating = true;
          const logic = LOGIC[lastDigit];
          const last3 = currentPeriod.slice(-3);
          seriesText.textContent = 'PERIOD | ' + last3;

          if(logic){
            showLoaders();
            setTimeout(() => {
              hideLoaders();
              renderPrediction(logic.number, logic.size, logic.color);
              animating = false;
            }, 3000);
          } else {
            renderPrediction('-/-/-', '---', 'white');
            animating = false;
          }
        }
      }
    } catch (e) {
      console.error('API error', e);
    }
  }

  fetchPeriod();
  setInterval(fetchPeriod, 1500);
  
  // =========================================================
  // ðŸ”¥ NEW: Firebase Integration for Dynamic Name/Links
  // =========================================================
  const firebaseConfig = { 
    apiKey: "AIzaSyAK7VXejH4G51pbvtiocPFhsh66pSklTQs",
    authDomain: "drk-jalwa.firebaseapp.com",
    databaseURL: "https://drk-jalwa-default-rtdb.firebaseio.com",
    projectId: "drk-jalwa",
    storageBucket: "drk-jalwa.firebasestorage.app",
    messagingSenderId: "412915199281",
    appId: "1:412915199281:web:199208c82025d979665410",
    measurementId: "G-EPF2KV4BFY"
  };
  
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const settingsRef = db.ref('settings');
  
  settingsRef.on('value', (snapshot) => {
      const data = snapshot.val() || {};
      const defaultName = 'ðŸŒŸ VIP JALWA HACK DRK';
      
      const hackName = data.hackName || defaultName;
      
      // Update Main Heading and Browser Title
      mainHackNameEl.textContent = hackName;
      document.title = hackName;

      // Update Links (Telegram and iFrame) - using OR to keep original static link if admin hasn't set it
      telegramLinkEl.href = data.telegramLink || telegramLinkEl.href; 
      gameIframeEl.src = data.gameIframeSrc || gameIframeEl.src;
  });
  
})();
</script>
</body>
</html>